meta:
  vendor: fortinet
  profile: baseline-lite
  version: "0.1.2"

rules:
  # Gestión insegura
  - id: FORTI-ADM-HTTP
    title: "Administración en HTTP habilitada"
    severity: "critical"
    match:
      any_of:
        - contains: "set admin-http enable"
        - contains: "set admin-port 80"
    remediation: "Desactivar HTTP y usar HTTPS en puerto no estándar."

  - id: FORTI-IFACE-WAN-HTTP
    title: "Interface WAN permite HTTP en administración"
    severity: "critical"
    match:
      regex: "(?is)config\\s+system\\s+interface.*?edit\\s+\"?wan[0-9]*\"?.*?allowaccess.*\\bhttp\\b.*?end"
    remediation: "Eliminar HTTP de allowaccess en interfaces WAN."

  - id: FORTI-MGMT-WAN-EXPOSED
    title: "Gestión expuesta en WAN (HTTPS/SSH)"
    severity: "high"
    match:
      regex: "(?is)config\\s+system\\s+interface.*?edit\\s+\"?wan[0-9]*\"?.*?allowaccess.*\\b(https|ssh)\\b.*?end"
    remediation: "Restringir administración a redes internas/VPN; usar ACL o trusted hosts."

  - id: FORTI-ADMIN-REDIRECT-DISABLED
    title: "Redirección a HTTPS deshabilitada"
    severity: "medium"
    match:
      any_of:
        - contains: "set gui-https-redirect disable"
    remediation: "Habilitar redirección a HTTPS para la GUI."

  # SNMP
  - id: FORTI-SNMP-COMMUNITY-DEFAULT
    title: "SNMP community por defecto (public/private)"
    severity: "medium"
    match:
      regex: "(?im)^(\\s*community\\s+\"?(public|private)\"?|\\s*set\\s+name\\s+\"?(public|private)\"?)\\b"
    remediation: "Usar SNMPv3 o comunidades robustas con ACL."

  - id: FORTI-SNMP-V2-ENABLED
    title: "Uso de SNMP v1/v2c detectado"
    severity: "low"
    match:
      any_of:
        - contains: "config system snmp community"
    remediation: "Preferir SNMPv3 con autenticación/cifrado."

  # Cifrado/Protocolos
  - id: FORTI-SSH-WEAK-CIPHERS
    title: "Cifrados/ajustes SSH débiles"
    severity: "medium"
    match:
      any_of:
        - contains: "set ssh-cbc enable"
        - contains: "set strong-crypto disable"
    remediation: "Deshabilitar CBC/MD5; habilitar strong-crypto."

  - id: FORTI-TLS-MIN-LEGACY
    title: "Versión mínima TLS insegura"
    severity: "medium"
    match:
      regex: "(?i)set\\s+ssl-min-proto-version\\s+(tlsv1-0|tlsv1-1)"
    remediation: "Configurar TLS mínimo en 1.2 o superior."

  # Políticas
  - id: FORTI-POLICY-SERVICE-ALL
    title: "Política usa servicio ALL"
    severity: "medium"
    match:
      any_of:
        - contains: 'set service "ALL"'
    remediation: "Restringir a puertos/servicios necesarios."

  - id: FORTI-POLICY-ANY-TO-ANY
    title: "Política muy amplia (ANY->ANY)"
    severity: "high"
    match:
      regex: "(?is)edit\\s+\\d+.*?set\\s+srcaddr\\s+\"?ANY\\b.*?set\\s+dstaddr\\s+\"?ANY\\b.*?end"
    remediation: "Restringir orígenes/destinos a los mínimos necesarios."

  - id: FORTI-POLICY-NO-LOG
    title: "Política con logging deshabilitado"
    severity: "low"
    match:
      any_of:
        - contains: "set logtraffic disable"
    remediation: "Habilitar logging en políticas relevantes."

  # VIP / publicación de servicios
  - id: FORTI-VIP-HTTP-EXPOSED
    title: "VIP publica HTTP (puerto 80)"
    severity: "medium"
    match:
      regex: "(?is)config\\s+firewall\\s+vip.*?portforward\\s+enable.*?extport\\s+80.*?mappedport\\s+80"
    remediation: "Preferir HTTPS/443 o proteger con WAF/IPS."

  - id: FORTI-VIP-MGMT-PORTS
    title: "VIP expone puertos de administración (22/3389/5900)"
    severity: "high"
    match:
      regex: "(?is)config\\s+firewall\\s+vip.*?portforward\\s+enable.*?extport\\s+(22|3389|5900).*?mappedport\\s+\\1"
    remediation: "Evitar exponer administración; usar VPN/jump hosts."

